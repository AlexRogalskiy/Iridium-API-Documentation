<link rel="stylesheet" href="css/custom-styles.css">
<div class="container">
    <div class="inner">
        <div class="side-nav">
            <ul>
                <li>
                    <h5><a href="#getting-started">Getting Started</a></h5>
                </li>
                <li>
                    <small><a href="#setting-up-plugin">Setting Up The Plugin</a></small>
                </li>
                <li>
                    <small><a href="#adding-website">Adding A Basic Website</a></small>
                </li>
                <li>
                    <small><a href="#connecting-iridium">Connecting With Iridium</a></small>
                </li>
                <li>
                    <small><a href="#getting-data">Getting Data From Iridium</a></small>
                </li>
                <li>
                    <small><a href="#subscribing-events">Subscribing For Events</a></small>
                </li>
            </ul>
        </div>
        <div class="main-content" id="top">
            <div class="contents">
                <h2>Hi there!</h2>
                <p>We are so excited to see you've decided to check out the plugin
                    API. </p>
                <p>With plugins, you can connect Iridium to any cloud services, integrate with countless apps and
                    customize your workflow almost endlessly. Sounds exciting? ðŸ¤© Making a plugin is super simple and
                    here you will have all you need to get started ðŸŽ‰</p>
                <blockquote class="info"> To enable plugin functionality, you will need to have a registered Iridium
                    Cloud account
                    and log in to Iridium Cloud.</blockquote>
                <div class="title-container">
                    <h2 id="getting-started">Getting Started </h2>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>In a nutshell, an Iridium plugin is a Node.js program running on it's own separate process. You know
                    what
                    that
                    means ðŸ¤“, you can almost do anything! </p>
                <p>To help you get started, here's a complete step-by-step guide to build a plugin. We are going to
                    build a
                    live web
                    dashboard that shows the progress of a task list.</p>
                <p>Here what the final result would look like</p>
                <img class="screenshot" src="/img/final.gif">
                <p>And all that is powered by your plugin, excited? Let's get started!</p>
                <blockquote> This guide assumes you have <a href="https://nodejs.org/en/">Node.js</a> 10 installed. If
                    you
                    haven't,
                    head over to Node.js website and download Node.js 10.</blockquote>
                <div class="title-container">
                    <h4 id="setting-up-plugin">Setting Up The Plugin </h4>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>Let's start by setting up our plugin, create a file named <code>package.json</code> with the
                    following contents and save it under a dedicated directory, say, <code>iridium-dashboard</code>
                </p>
                <pre><code>{
    "name": "idirium-dashboard",
    "version": "0.0.1",
    "description": "my first iridium plugin",
    "dependencies": {}
}</code></pre>
                <p>This will enable allow us to use <code>npm</code> to install some packages we need, for details
                    regarding <code>package.json</code>, see <a href="https://docs.npmjs.com/files/package.json">npm's
                        documentation</a>. Let's also add in the required <b>Iridium Plugin Manifest</b> as well, create
                    another file in the same
                    directory named <code>iridium.json</code>, we will go through it in detail later.</p>
                <blockquote class="important">Every plugin must have a valid<code>iridium.json</code> for it to be
                    recognized by Iridium
                </blockquote>
                <p>Let's put the following content into <code>iridium.json</code></p>
                <pre><code>{
    "id": "----REPLACE WITH YOUR OWN ID----",
    "name": "Cool Dashboard",
    "description": "A cool dashboard",
    "author": "Michael Lu",
    "image": "icon.png",
    "main": "index.js",
}</code></pre>
                <p>Then, we need to generate a unique ID for our plugin. You can use any <a
                        href="https://www.uuidgenerator.net/">online UUID generator</a> to generate one. After you
                    generate one, paste the ID you generated into <code>----RPLEACE WITH YOUR OWN ID----</code> and
                    save the file.</p>
                <p>So what is in <code>iridium.json</code>? It is the
                    basic config data that identifies your Node.js program to Iridium as a plugin. This way you can keep
                    your <code>package.json</code> separate, <code>package.json</code> file is not required for Iridium
                    to run. All fields are required. Several important things
                    to note for the manifest:</p>
                <ul>
                    <li><b>id</b> must be unuqie throughout all plugins in Iridium. Any UUID generator should give you
                        an unique UUID in the <b>world</b>. <blockquote>If plugins with duplicated IDs are found,
                            Iridium
                            will
                            refuse to load all of them and log them in <code>log.txt</code> file.</blockquote>
                    </li>
                    <li><b>main</b> must speficies a proper javascript file. In this case, it's the file
                        <code>index.js</code> under the top level directory of your plugin. Feel free to change it to
                        match your own folder structure.</li>
                    <li><b>image</b> must speficies a valid icon for your plugin, this will be displayed in Iridium's
                        plugin page.</li>
                </ul>
                <p>For the icon, you can download any image and save it in
                    <code>iridium-dashboard</code> folder as <code>icon.png</code>. For best results, use a high
                    definition square png file.</p>
                <p>Let's also add in an empty <code>index.js</code> file in <code>iridium-dashboard</code> for later.
                </p>
                <p>After you complete the steps, your plugin folder should look like this:</p>
                <pre><code>iridium-dashboard
|--index.js
|--iridium.json
|--package.json
|--icon.png</code></pre>
                <blockquote class="info">If you want to skip the web interface and jump to the plugin part, see <a
                        href="#connecting-iridium">Connecting With Iridium</a></blockquote>

                <div class="title-container">
                    <h4 id="adding-website">Adding A Basic Website </h4>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>Now let's add a basic web server and website to display our dashboard. First, add <a
                        href="https://expressjs.com/">express</a> as a dependency with the following command:</p>
                <p><code>npm install --save express</code></p>
                <p>After express is installed, add the following code in <code>index.js</code></p>
                <pre><code>const express = require('express');
const app = require('express')();
const http = require('http').Server(app);

app.use(express.static('public'));

http.listen(3000);</code></pre>
                <p>
                    <blockquote>This script will serve all files under <code>public</code> folder. You should make any
                        necessary adjustments to properly secure your files when running in production environment.
                    </blockquote>
                </p>
                <p>Then create folder <code>public</code> and create file <code>index.html</code> under it. Fill in the
                    following</p>
                <pre><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;title&gt;Iridium Dashboard&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;h1&gt;Hello Iridium&lt;/h1&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
                <p>Now open any terminal, change directory to <code>iridium-dashboard</code>. You should be able to run
                    <code>node index.js</code>. Then you should be able to open your browser, navigate to
                    <code>http://localhost:3000</code> and see the following:</p>
                <img class="screenshot" src="/img/sc01.png">
                <p>After you scessfully loaded the page, let's add in couple more things. First, create
                    <code>public/style.css</code> with the following contents: </p>
                <pre><code>body {
    background: #353535;
    color: #EFEFEF;
    font: 13px Helvetica, Arial;
    margin: 0;
}
.text-primary {
    color: #4287ff;
}
.container {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.large-text {
    font-size: 80px;
}</code></pre>
                <p>Then, modify <code>public/index.html</code> to contain the following: </p>
                <pre><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;title&gt;Iridium Dashboard&lt;/title&gt;
    &lt;link rel="stylesheet" href="/style.css"&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;div&gt;
            &lt;h1&gt;Dashboard&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;h3 class="text-primary" id="list-title"&gt;-&lt;/h3&gt;
        &lt;/div&gt;
        &lt;div&gt;
            &lt;h1 class="large-text" id="completed-tasks"&gt;0&lt;/h1&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
                <p>Then restart your server by re-running <code>node index.js</code>, refresh your browser, you should
                    see this:</p>
                <img class="screenshot" src="/img/sc02.png">
                <p>At this moment, your plugin folder should look like this:</p>
                <pre><code>iridium-dashboard
|--public
|  |--index.html
|  |--style.css
|--index.js
|--iridium.json
|--package.json
|--icon.png</code></pre>
                <div class="title-container">
                    <h4 id="connecting-iridium">Connecting With Iridium </h4>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>We are finally at the exciting part. So far the project is just
                    like any simple Node.js website, but we will now supercharge this website by connecting it with
                    Iridium.</p>
                <p>Let's start by going over how to connect your Node.js program with Iridium. Your main
                    file (previously specified in <code>iridium.json</code> and in this case is the
                    <code>index.js</code>) will need to become a module that fulfills
                    <code><a href="/?api#IPlugin">IPlugin</a></code> interface by providing a pre-defined export
                    <code>Initialize(iridium)</code>. When Iridium is ready to
                    load your plugin, it will call this function and provide your plugin with Iridium's capabilities in
                    <code>iridium</code> parameter.</p>
                <p>This way, you can perform your own initialization before your plugin is loaded if needed.</p>
                <blockquote class="important">If your main module does not export <code>Initialize</code> method, an
                    error will be logged in <code>log.txt</code> and your plugin will appear in error state in the
                    Plugins page
                </blockquote>
                <blockquote class="info">For details about on the <code>iridium</code> parameter and its full
                    capabilities, see <a href="/?api#IridiumApp"><code>IridiumApp</code></a></blockquote>
                <p>To do that, let's first modify <code>index.js</code> to the following:</p>
                <pre><code>const express = require('express');
const app = require('express')();
const http = require('http').Server(app);

app.use(express.static('public'))

http.listen(3000);

// --- The above will run first ---

module.exports.Initialize = (iridium) => {
    // --- Iridium will call this function here and pass in the app context --- 
}</code></pre>
                <p>And that's it! Your Node.js program is an Iridium plugin ðŸ˜Ž, simple enough right? </p>
                <p>Let's try it out, exit Iridium if it's open and the Node.js server if it's still running, then copy
                    the whole directory into
                    <code>Your Home Directory/Iridium/plugins</code> as a directory.</p>
                <p>Afterwards, your <code>Iridium</code> directory should look like the following</p>
                <pre><code>Iridium
|--plugins
|  |--iridium-dashboard
|  |  |--public
|  |  |  |--index.html
|  |  |  |--style.css
|  |  |--index.js
|  |  |--iridium.json
|  |  |--package.json
|  |  |--icon.png
|--data.json
|--settings.json
|--...</code></pre>
                <p>Then, start Iridium app, click <code>Plugins</code> on the left navigation panel, you should see this
                </p>
                <img class="screenshot" src="/img/sc03.png">
                <p>See that green dot? That means the plugin is up and running, you should be able to point your browser
                    to <code>http://localhost:3000</code> and see the same page as before</p>
                <p>If you can see the green dot and browse the web page, your plugin is now up and
                    running in Iridium. Keep in mind that plugin feature is only available when you are logged in to
                    Iridium
                    Cloud. All plugins will be deactivated when you log out.</p>
                <p>Since we've successfully enabled the plugin, we can do the rest of the tutorial using the files under
                    <code>Your Home Directory/Iridium/plugins/iridium-dashboard</code></p>
                <div class="title-container">
                    <h4 id="getting-data">Getting Data From Iridium </h4>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>Now let's actually make our dashboard show something. First, we will add <a
                        href="https://socket.io">socket.io</a> as a
                    dependency to enable realtime communication between our plugin and the web interface. Open up a
                    terminal at the <code>iridium-dashboard</code> and run <code>npm install --save socket.io</code></p>
                <p>Then, add these at the bottom of the <code>&lt;head&gt;</code> section:</p>
                <pre><code>&lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;
&lt;script src="https://code.jquery.com/jquery-1.11.1.js"&gt;&lt;/script&gt;</code></pre>
                <p>This will add necessary libraries in our web interface. Then, add the following script in after
                    <code>&lt;/body&gt;</code> section:</p>
                <pre><code>&lt;script&gt;
$(function () {
    var socket = io();
    socket.on('list-data', (data) => {
        $('#list-title').html(data.listTitle);
        $('#completed-tasks').html(data.completedPercentage + '%');
    });
});
&lt;/script&gt;</code></pre>
                <p>This script will update the dashboard in realtime when a message is received from the plugin.</p>
                <p>Finally, let's modify <code>index.js</code> to the following:</p>
                <pre><code>const express = require('express');
const app = require('express')();
const http = require('http').Server(app);
const io = require('socket.io')(http);

app.use(express.static('public'));

http.listen(3000);

const listData = {
    listTitle: '',
    completedPercentage: 0
};

io.on('connection', (socket) => {
    socket.emit('list-data', listData);
});

module.exports.Initialize = (iridium) => {
    iridium.TaskLists.GetTaskLists().then((data) => {
        if (data.length) {
            listData.listTitle = data[0].title;
            listData.completedPercentage = data[0].completedPercentage;
            io.emit('list-data', listData);
        }
    });
}</code></pre>
                <p>Let's briefly go over these changes:</p>
                <p>First, we use a simple global variable <code>listData</code> to keep track of the data we are
                    interested in. Alternatively, you can implement or connect to other services to store the data</p>
                <pre><code>const listData = {
    listTitle: '',
    completedPercentage: 0
};</code></pre>
                <p>Then, we send out the data to any newly connected clients with the following code:</p>
                <pre><code>io.on('connection', (socket) => {
    socket.emit('list-data', listData);
});</code></pre>
                <p>Lastly, we use <code>iridium.TaskLists.GetTaskLists()</code> to retrieve all task lists in
                    <code>Initialize</code>, update and send out the data our dashboard is expecting</p>
                <pre><code>iridium.TaskLists.GetTaskLists().then((data) => {
if (data.length) {
    listData.listTitle = data[0].title;
    listData.completedPercentage = data[0].completedPercentage;
    io.emit('list-data', listData);
}</code></pre>
                <p>Then, we only get the first list out of all task lists and record the data we care about. You can
                    extend
                    it to report all task lists and more data.</p>
                <blockquote class="info">Here the tutorial assumes your Iridium has no existing task lists. If you do,
                    you might see different results</blockquote>
                <p>Now, let's restart Iridium, add a list named <code>My To Do's</code> and create couple tasks and mark
                    some of them as done, like this:</p>
                <img class="screenshot" src="/img/sc04.png">
                <p>And, if we refresh our page at <code>http://localhost:3000</code>, we should see this:</p>
                <img class="screenshot" src="/img/sc05.png">
                <p>Hummm... Doesn't really look right. That's because our plugin only <b>gets</b> data from Iridium
                    during <code>Initialize</code>. So it wouldn't know about any new data after
                    <code>Initialize</code>, including the new list we added.
                </p>
                <p>To fix this for now, let's restart Iridium. Thanks to socket.io, your dashboard should
                    update automatically to this.</p>
                <img class="screenshot" src="/img/sc06.png">
                <p>Now our dashboard is working...ðŸ¤” Well not quite, we still
                    will need to restart Iridium to see the new data. That's not really good, and we will fix this
                    in the next section.</p>
                <div class="title-container">
                    <h4 id="subscribing-events">Subscribing For Events </h4>
                    <small class="go-to-top-button"><a href="#top"><i class="fas fa-arrow-up"></i></a></small>
                </div>
                <p>Let's complete our dashboard by subscribing to Iridium's events. Iridium will emit specific events
                    when things changes in the app, such as when a list's progress is updated. Your plugin can listen to
                    those and know exactly when new data is available.</p>
                <p>To subscribe for the event, we will use the <code>on</code> function. Let's modify
                    <code>index.js</code>
                    to the following:</p>
                <pre><code>const express = require('express');
const app = require('express')();
const http = require('http').Server(app);
const io = require('socket.io')(http);

app.use(express.static('public'));

http.listen(3000);

const listData = {
    listID: '', // we keep track of the list id to know which one's progress is updated
    listTitle: '',
    completedPercentage: 0
};

io.on('connection', (socket) => {
    socket.emit('list-data', listData);
});

module.exports.Initialize = (iridium) => {
    iridium.TaskLists.GetTaskLists().then((data) => {
        if (data.length) {
            listData.listID = data[0].id
            listData.listTitle = data[0].title;
            listData.completedPercentage = data[0].completedPercentage;
            io.emit('list-data', listData);
        }
    });
    iridium.TaskLists.on(iridium.TaskEvents.TaskListProgressUpdated, (progress) => {
        if (progress.listId === listData.listID) {
            // if the progress update event is about the list we care about, update the progress percentage
            listData.completedPercentage = progress.completedPercentage;
            io.emit('list-data', listData);
        }
    });
}</code></pre>
                <p>Let's look at the subscribing part a bit more. When a list's progress is updated, Iridium will emit
                    <code>TaskListProgressUpdated</code> event and pass relevant data into the handler using
                    <code>eventArgs</code>. Our plugin then record the data, and send the data to our clients using
                    socket.io</p>
                <blockquote class="info"><code>iridium.TaskEvents.TaskListProgressUpdated</code> is just one of many
                    events you can
                    subscribe to. Head over to the <a href="/?api#IridiumApp.TaskLists#on">API section</a> to see all
                    events available
                </blockquote>
                <blockquote>
                    Remember, an event handler will stay subscribed after you call <code>on</code>. To unsubscribed a
                    handler, use <a href="?api#IridiumApp.TaskLists#off"><code>off</code></a> function
                </blockquote>
                <p>With this, let's restart Iridium, start ticking off tasks in our list and look at the magic!</p>
                <img class="screenshot" src="/img/final.gif">
                <p>Congratulations! You've successfully made a live dashboard. But these are just some of the plugin
                    system's feature we covered. Continue reading the rest of this guide to learn more about other
                    features.</p>
                <p>The complete example code can be found at the <a
                        href="https://github.com/Yamazaki93/Iridium-Dashboard">Iridium Dashboard Repo</a></p>
            </div>
        </div>
    </div>
</div>